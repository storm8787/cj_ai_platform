"""
ì—…ë¬´ë³´ê³  ìƒì„±ê¸° API - ê³µë¬´ì› í–‰ì •ë¬¸ì„œ ìŠ¤íƒ€ì¼
ì„¹ì…˜ë³„ íŠ¹ì„±ì— ë§žëŠ” ì°¨ë³„í™”ëœ í”„ë¡¬í”„íŠ¸ ì ìš©
"""
from fastapi import APIRouter, HTTPException
from pydantic import BaseModel
from typing import List, Dict, Any, Optional
import json
import re
from datetime import datetime

from config import settings

router = APIRouter()


# ===========================================
# ðŸ“‹ ìš”ì²­/ì‘ë‹µ ëª¨ë¸
# ===========================================
class ReportGenerateRequest(BaseModel):
    title: str
    report_type: str
    detail_type: str
    keywords: str
    length: str = "í‘œì¤€"


class ReportSection(BaseModel):
    title: str
    order: int
    content: List[str]


class ReportResponse(BaseModel):
    title: str
    type: str
    detail_type: str
    summary: str
    sections: List[ReportSection]
    metadata: Dict[str, Any]
    success: bool


class StructureResponse(BaseModel):
    report_types: Dict[str, Dict[str, List[str]]]
    length_options: List[str]


# ===========================================
# ðŸ“š ë³´ê³ ì„œ êµ¬ì¡° ì •ì˜
# ===========================================
REPORT_STRUCTURES: Dict[str, Dict[str, List[str]]] = {
    "ê³„íš ë³´ê³ ì„œ": {
        "ê¸°ë³¸ ê³„íš": ["ì¶”ì§„ë°°ê²½", "í˜„í™©", "ì¶”ì§„ê³„íš", "ì„¸ë¶€ë‚´ìš©", "ì¶”ì§„ì¼ì •", "ê¸°ëŒ€íš¨ê³¼"],
        "ì„¸ë¶€ ê³„íš": ["ì¶”ì§„ë°°ê²½", "í˜„í™©ë¶„ì„", "ì¶”ì§„ëª©í‘œ", "ì¶”ì§„ì „ëžµ", "ì„¸ë¶€ì¶”ì§„ê³„íš", "ì†Œìš”ì˜ˆì‚°", "ê¸°ëŒ€íš¨ê³¼"],
        "ì‚¬ì—… ê³„íš": ["ì‚¬ì—…ê°œìš”", "ì¶”ì§„ë°°ê²½", "í˜„í™©", "ì‚¬ì—…ë‚´ìš©", "ì¶”ì§„ì¼ì •", "ì†Œìš”ì˜ˆì‚°", "í˜‘ì¡°ì‚¬í•­", "ê¸°ëŒ€íš¨ê³¼"],
    },
    "ëŒ€ì±… ë³´ê³ ì„œ": {
        "ë¬¸ì œ í•´ê²°": ["ì¶”ì§„ë°°ê²½", "í˜„í™©", "ë¬¸ì œì ", "ê°œì„ ëŒ€ì±…", "ì¶”ì§„ì¼ì •", "ê¸°ëŒ€íš¨ê³¼"],
        "ìœ„ê¸° ê´€ë¦¬": ["í˜„ì•ˆë¬¸ì œ", "í˜„í™©ë¶„ì„", "ìœ„í—˜ìš”ì†Œ", "ëŒ€ì‘ë°©ì•ˆ", "ì´í–‰ê³„íš", "ê¸°ëŒ€íš¨ê³¼"],
        "ê°œì„ ì•ˆ": ["í˜„ìƒì§„ë‹¨", "ë¬¸ì œë¶„ì„", "ê°œì„ ëª©í‘œ", "ê°œì„ ë°©ì•ˆ", "ì‹¤í–‰ê³„íš", "ê¸°ëŒ€íš¨ê³¼"],
    },
    "ìƒí™© ë³´ê³ ì„œ": {
        "í˜„í™©": ["ë³´ê³ ì¼ì‹œ", "ìƒí™©ê°œìš”", "í˜„ìž¬ìƒíƒœ", "ì¡°ì¹˜ì‚¬í•­", "í–¥í›„ê³„íš"],
        "ì§„í–‰ ìƒí™©": ["ì‚¬ì—…ê°œìš”", "ì¶”ì§„ê²½ê³¼", "ì§„í–‰í˜„í™©", "ì£¼ìš”ì„±ê³¼", "ë¬¸ì œì ", "í–¥í›„ê³„íš"],
        "ì‚¬ê±´ ë³´ê³ ": ["ë°œìƒì¼ì‹œ", "ë°œìƒìž¥ì†Œ", "ì‚¬ê±´ê°œìš”", "í”¼í•´ìƒí™©", "ì¡°ì¹˜ì‚¬í•­", "í›„ì†ëŒ€ì±…"],
    },
    "ë¶„ì„ ë³´ê³ ì„œ": {
        "ë°ì´í„° ë¶„ì„": ["ë¶„ì„ëª©ì ", "ë¶„ì„ë°©ë²•", "ë°ì´í„°ê°œìš”", "ë¶„ì„ê²°ê³¼", "ì‹œì‚¬ì ", "ê²°ë¡ "],
        "ì„±ê³¼ ë¶„ì„": ["ì‚¬ì—…ê°œìš”", "ë¶„ì„ëª©ì ", "ì„±ê³¼ì§€í‘œ", "ë¶„ì„ê²°ê³¼", "ê°œì„ ì‚¬í•­", "ê²°ë¡ "],
        "ë™í–¥ ë¶„ì„": ["ë¶„ì„ë°°ê²½", "ì£¼ìš”ë™í–¥", "ì˜í–¥ë¶„ì„", "ëŒ€ì‘ë°©ì•ˆ", "ê²°ë¡ "],
    },
    "ê¸°íƒ€ ë³´ê³ ì„œ": {
        "ê°„ëžµ ë©”ëª¨": ["ë‚ ì§œ", "ì£¼ìš”ë‚´ìš©", "íŠ¹ì´ì‚¬í•­", "í›„ì†ì¡°ì¹˜"],
        "íšŒì˜ ê²°ê³¼": ["íšŒì˜ì¼ì‹œ", "ì°¸ì„ìž", "íšŒì˜ì•ˆê±´", "ì£¼ìš”ë…¼ì˜ì‚¬í•­", "ê²°ì •ì‚¬í•­", "í–¥í›„ì¼ì •"],
        "ì—…ë¬´ ë©”ëª¨": ["ìž‘ì„±ì¼", "ì—…ë¬´ê°œìš”", "ì²˜ë¦¬ë‚´ìš©", "ì°¸ê³ ì‚¬í•­", "í›„ì†ì¡°ì¹˜"],
    },
}

LENGTH_RULES = {
    "ê°„ëžµ": {"items_per_section": "3~4", "detail_level": "í•µì‹¬ë§Œ ê°„ëžµížˆ"},
    "í‘œì¤€": {"items_per_section": "4~6", "detail_level": "êµ¬ì²´ì  ë‚´ìš© í¬í•¨"},
    "ìƒì„¸": {"items_per_section": "6~8", "detail_level": "ë§¤ìš° ìƒì„¸í•˜ê²Œ"},
}


# ===========================================
# ðŸŽ¯ ì„¹ì…˜ë³„ ìž‘ì„± ìŠ¤íƒ€ì¼ ì •ì˜ (í•µì‹¬!)
# ===========================================
SECTION_STYLES = {
    # ==================
    # ì„œìˆ í˜• ì„¹ì…˜ (ë¬¸ìž¥í˜•, ìƒì„¸ ì„¤ëª… í•„ìš”)
    # ==================
    "ì¶”ì§„ë°°ê²½": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì™œ ì´ ì‚¬ì—…/ì •ì±…ì´ í•„ìš”í•œì§€ ë°°ê²½ê³¼ í•„ìš”ì„±ì„ êµ¬ì²´ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ 2~3ë¬¸ìž¥ìœ¼ë¡œ ìƒì„¸ížˆ ê¸°ìˆ ",
        "example": "ê´€ë‚´ 5ëŒ€ ë²”ì£„ ë°œìƒê±´ìˆ˜ê°€ ì „ë…„ ëŒ€ë¹„ 12% ì¦ê°€(2024ë…„ 1,234ê±´ â†’ 2025ë…„ 1,382ê±´)í•˜ì—¬ ì£¼ë¯¼ ì•ˆì „ ê°•í™”ë¥¼ ìœ„í•œ ëŒ€ì±… ë§ˆë ¨ì´ ì‹œê¸‰í•œ ì‹¤ì •ìž„. íŠ¹ížˆ ì•¼ê°„ ì‹œê°„ëŒ€ ì´ë©´ë„ë¡œì—ì„œì˜ ë²”ì£„ ë°œìƒë¥ ì´ ë†’ì•„ CCTV ì‚¬ê°ì§€ëŒ€ í•´ì†Œê°€ í•„ìš”í•¨"
    },
    "í˜„í™©": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ìƒí™©ì„ êµ¬ì²´ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ ê°ê´€ì ìœ¼ë¡œ ê¸°ìˆ . ë¬¸ì œì ì´ë‚˜ ë¶€ì¡±í•œ ì ë„ í•¨ê»˜ ì–¸ê¸‰",
        "example": "í˜„ìž¬ ê´€ë‚´ ë°©ë²”ìš© CCTVëŠ” ì´ 856ëŒ€ê°€ ìš´ì˜ ì¤‘ì´ë©°, ì´ ì¤‘ 5ë…„ ì´ìƒ ë…¸í›„ ìž¥ë¹„ê°€ 274ëŒ€(32%)ë¡œ í™”ì§ˆ ì €í•˜ ë° ì•¼ê°„ ì‹ë³„ ì–´ë ¤ì›€ì´ ë°œìƒí•˜ê³  ìžˆìŒ. CCTV ì‚¬ê°ì§€ëŒ€ëŠ” ì´ë©´ë„ë¡œ 23ê°œì†Œ, ê³µì› ì£¼ë³€ 15ê°œì†Œ ë“± ì´ 38ê°œì†Œë¡œ íŒŒì•…ë¨"
    },
    "í˜„í™©ë¶„ì„": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ìƒí™©ì„ ë¶„ì„í•˜ì—¬ ë¬¸ì œì ê³¼ ì›ì¸ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "í˜„ìž¬ ê´€ë‚´ ë°©ë²” ì¸í”„ë¼ í˜„í™©ì„ ë¶„ì„í•œ ê²°ê³¼, CCTV ë°€ë„ê°€ ì¸êµ¬ 1,000ëª…ë‹¹ 3.2ëŒ€ë¡œ ë„ë‚´ í‰ê· (4.5ëŒ€) ëŒ€ë¹„ ë‚®ì€ ìˆ˜ì¤€ìž„. íŠ¹ížˆ ì‹ ê·œ íƒì§€ê°œë°œì§€êµ¬ì˜ ê²½ìš° ìž…ì£¼ í›„ 2ë…„ì´ ê²½ê³¼í•˜ì˜€ìœ¼ë‚˜ ë°©ë²”ì‹œì„¤ ì„¤ì¹˜ê°€ ë¯¸ë¹„í•œ ìƒí™©ìž„"
    },
    "ë¬¸ì œì ": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ë°œìƒí•˜ê³  ìžˆëŠ” ë¬¸ì œì ì„ êµ¬ì²´ì  ì‚¬ë¡€ì™€ ìˆ˜ì¹˜ë¡œ ê¸°ìˆ ",
        "example": "ì²«ì§¸, ë…¸í›„ CCTV ìž¥ë¹„ì˜ í•´ìƒë„ ì €í•˜ë¡œ ë²”ì¸ ì‹ë³„ì´ ì–´ë ¤ì›Œ ê²€ê±°ìœ¨ì´ í•˜ë½(ì „ë…„ ëŒ€ë¹„ 8%p ê°ì†Œ)í•˜ê³  ìžˆìŒ. ë‘˜ì§¸, ì•¼ê°„ ì¡°ëª… ë¶€ì¡± ì§€ì—­ì—ì„œ ì´¬ì˜ëœ ì˜ìƒì˜ í™œìš©ë„ê°€ í˜„ì €ížˆ ë‚®ìŒ"
    },
    "ì‚¬ì—…ê°œìš”": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì‚¬ì—…ì˜ ì „ì²´ì ì¸ ê°œìš”ë¥¼ ëª©ì , ëŒ€ìƒ, ê·œëª¨ ë“±ì„ í¬í•¨í•˜ì—¬ ê¸°ìˆ ",
        "example": "ë³¸ ì‚¬ì—…ì€ ì‹œë¯¼ ì•ˆì „ ê°•í™”ë¥¼ ìœ„í•´ ë²”ì£„ ì·¨ì•½ì§€ì—­ì— ê³ í™”ì§ˆ CCTVë¥¼ ì‹ ê·œ ì„¤ì¹˜í•˜ëŠ” ì‚¬ì—…ìœ¼ë¡œ, ì´ ì‚¬ì—…ë¹„ 3ì–µì›ì„ íˆ¬ìž…í•˜ì—¬ 15ê°œ ì§€ì ì— 50ëŒ€ì˜ CCTVë¥¼ ì„¤ì¹˜í•  ê³„íšìž„"
    },
    "í˜„ì•ˆë¬¸ì œ": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ë‹¹ë©´í•œ ë¬¸ì œ ìƒí™©ì„ ê¸´ê¸‰ì„±ê³¼ ì‹¬ê°ì„± ì¤‘ì‹¬ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ìµœê·¼ ê´€ë‚´ â—‹â—‹ë™ ì¼ì›ì—ì„œ ì—°ì† ì ˆë„ì‚¬ê±´ì´ ë°œìƒ(1ì£¼ì¼ê°„ 5ê±´)í•˜ì—¬ ì£¼ë¯¼ ë¶ˆì•ˆì´ ê°€ì¤‘ë˜ê³  ìžˆìœ¼ë©°, í•´ë‹¹ ì§€ì—­ì€ CCTV ë¯¸ì„¤ì¹˜ êµ¬ê°„ìœ¼ë¡œ ë²”ì¸ ê²€ê±°ì— ì–´ë ¤ì›€ì„ ê²ªê³  ìžˆìŒ"
    },
    "ìƒí™©ê°œìš”": {
        "style": "ì„œìˆ í˜•",
        "guide": "ë°œìƒí•œ ìƒí™©ì˜ ì „ì²´ì ì¸ ê°œìš”ë¥¼ ìœ¡í•˜ì›ì¹™ì— ë”°ë¼ ê¸°ìˆ ",
        "example": "2026. 1. 15.(ì›”) 14:30ê²½ â—‹â—‹ë™ ì£¼ë¯¼ì„¼í„° ì•ž ë„ë¡œì—ì„œ ì°¨ëŸ‰ 2ëŒ€ ì¶”ëŒì‚¬ê³ ê°€ ë°œìƒí•˜ì˜€ìœ¼ë©°, ì¸ëª…í”¼í•´ëŠ” ì—†ìœ¼ë‚˜ ì°¨ëŸ‰ íŒŒì† ë° êµí†µ ì •ì²´ê°€ ë°œìƒí•¨"
    },
    "ì‚¬ê±´ê°œìš”": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì‚¬ê±´ì˜ ê²½ìœ„ë¥¼ ì‹œê°„ ìˆœì„œëŒ€ë¡œ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "2026. 1. 15.(ì›”) 14:30ê²½ â—‹â—‹êµì°¨ë¡œì—ì„œ ì‹ í˜¸ìœ„ë°˜ ì°¨ëŸ‰ì´ íš¡ë‹¨ë³´ë„ë¥¼ ê±´ë„ˆë˜ ë³´í–‰ìžë¥¼ ì¶©ê²©í•˜ëŠ” ì‚¬ê³ ê°€ ë°œìƒí•¨. í”¼í•´ìžëŠ” ì¸ê·¼ ë³‘ì›ìœ¼ë¡œ ì´ì†¡ë˜ì–´ ì¹˜ë£Œ ì¤‘ì´ë©° ìƒëª…ì—ëŠ” ì§€ìž¥ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë¨"
    },
    
    # ==================
    # ë‚˜ì—´í˜• ì„¹ì…˜ (í•­ëª©:ë‚´ìš© í˜•íƒœ, ê°„ê²°í•˜ê²Œ)
    # ==================
    "ì¶”ì§„ì¼ì •": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì‹œê¸°:ë‚´ìš© í˜•íƒœë¡œ ê°„ê²°í•˜ê²Œ ë‚˜ì—´. ë¬¸ìž¥í˜• ì¢…ê²°ì–´ë¯¸ ì‚¬ìš© ê¸ˆì§€",
        "example": "ì‹¤ì‹œì„¤ê³„: 2026. 1~2ì›” / ê³µì‚¬ë°œì£¼: 2026. 3ì›” / ì„¤ì¹˜ê³µì‚¬: 2026. 4~5ì›” / ì¤€ê³µ: 2026. 6ì›”"
    },
    "ì†Œìš”ì˜ˆì‚°": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "í•­ëª©:ê¸ˆì•¡ í˜•íƒœë¡œ ê°„ê²°í•˜ê²Œ ë‚˜ì—´. ì´ì•¡ì„ ë¨¼ì € ì œì‹œí•˜ê³  ì„¸ë¶€ë‚´ì—­ ê¸°ìˆ ",
        "example": "ì´ ì‚¬ì—…ë¹„: 3ì–µì› / ìž¥ë¹„êµ¬ìž…ë¹„: 2ì–µì›(CCTV 50ëŒ€, ì €ìž¥ìž¥ì¹˜ ë“±) / ì„¤ì¹˜ê³µì‚¬ë¹„: 0.8ì–µì› / í†µì‹ ë¹„: 0.2ì–µì›(ì—°ê°„)"
    },
    "í˜‘ì¡°ì‚¬í•­": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ê¸°ê´€ëª…:í˜‘ì¡°ë‚´ìš© í˜•íƒœë¡œ ê°„ê²°í•˜ê²Œ ë‚˜ì—´",
        "example": "â—‹â—‹ê²½ì°°ì„œ: CCTV ì˜ìƒ ì—°ê³„ ë° ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ / í•œêµ­ì „ë ¥: ì „ìš© ì „ë ¥ ì¸ìž… í˜‘ì¡° / í†µì‹ ì‚¬: ì „ìš©íšŒì„  ì„¤ì¹˜"
    },
    "ì¶”ì§„ê²½ê³¼": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì‹œê¸°:ì¶”ì§„ë‚´ìš© í˜•íƒœë¡œ ì‹œê°„ìˆœ ë‚˜ì—´",
        "example": "2025. 6ì›”: ì‚¬ì—…ê³„íš ìˆ˜ë¦½ / 2025. 9ì›”: ì‹¤ì‹œì„¤ê³„ ì™„ë£Œ / 2025. 11ì›”: ê³µì‚¬ ì°©ê³µ / 2026. 1ì›”: ê³µì •ë¥  60% ì§„í–‰ ì¤‘"
    },
    "í–¥í›„ì¼ì •": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì‹œê¸°:ì˜ˆì •ë‚´ìš© í˜•íƒœë¡œ ê°„ê²°í•˜ê²Œ ë‚˜ì—´",
        "example": "2026. 2ì›”: ì‹œì„¤ë¬¼ ì„¤ì¹˜ ì™„ë£Œ / 2026. 3ì›”: ì‹œìš´ì „ ë° ê²€ìˆ˜ / 2026. 4ì›”: ì •ì‹ ìš´ì˜ ê°œì‹œ"
    },
    "ë³´ê³ ì¼ì‹œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë‚ ì§œ, ì‹œê°„, ë³´ê³ ìž ë“±ì„ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ë³´ê³ ì¼ì‹œ: 2026. 1. 27.(ì›”) 14:00 / ë³´ê³ ìž: â—‹â—‹ê³¼ â—‹â—‹â—‹ / ë³´ê³ ëŒ€ìƒ: ì‹œìž¥"
    },
    "ë°œìƒì¼ì‹œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë°œìƒ ì¼ì‹œì™€ ìž¥ì†Œë¥¼ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ë°œìƒì¼ì‹œ: 2026. 1. 15.(ì›”) 14:30ê²½ / ë°œìƒìž¥ì†Œ: â—‹â—‹ë™ â—‹â—‹ë¡œ 123 ì•ž êµì°¨ë¡œ"
    },
    "ì°¸ì„ìž": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì†Œì†:ì§ê¸‰ ì„±ëª… í˜•íƒœë¡œ ë‚˜ì—´",
        "example": "â—‹â—‹ê³¼: ê³¼ìž¥ â—‹â—‹â—‹, ë‹´ë‹¹ â—‹â—‹â—‹ / â—‹â—‹ê²½ì°°ì„œ: ê²½ìœ„ â—‹â—‹â—‹ / â—‹â—‹ì—…ì²´: ëŒ€í‘œ â—‹â—‹â—‹"
    },
    "íšŒì˜ì¼ì‹œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì¼ì‹œ, ìž¥ì†Œ, ì°¸ì„ì¸ì› ë“±ì„ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ì¼ì‹œ: 2026. 1. 20.(ì›”) 10:00~12:00 / ìž¥ì†Œ: ì‹œì²­ 3ì¸µ ëŒ€íšŒì˜ì‹¤ / ì°¸ì„: 15ëª…"
    },
    
    # ==================
    # ëª©í‘œ/íš¨ê³¼í˜• ì„¹ì…˜ (ì •ëŸ‰+ì •ì„± ëª©í‘œ ê¸°ìˆ )
    # ==================
    "ê¸°ëŒ€íš¨ê³¼": {
        "style": "íš¨ê³¼í˜•",
        "guide": "ì •ëŸ‰ì  ëª©í‘œ(ìˆ˜ì¹˜)ì™€ ì •ì„±ì  íš¨ê³¼ë¥¼ ëª¨ë‘ í¬í•¨í•˜ì—¬ 2~3ë¬¸ìž¥ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "CCTV ì„¤ì¹˜ ì™„ë£Œ ì‹œ ê´€ë‚´ 5ëŒ€ ë²”ì£„ ë°œìƒë¥  20% ê°ì†Œ ë° ë²”ì¸ ê²€ê±°ìœ¨ 15%p í–¥ìƒì´ ì˜ˆìƒë¨. ë˜í•œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì²´ê³„ êµ¬ì¶•ìœ¼ë¡œ ê¸´ê¸‰ìƒí™© ëŒ€ì‘ì‹œê°„ì´ ë‹¨ì¶•ë˜ì–´ ì‹œë¯¼ ì²´ê°ì•ˆì „ë„ê°€ í¬ê²Œ í–¥ìƒë  ê²ƒìœ¼ë¡œ ê¸°ëŒ€ë¨"
    },
    "ì¶”ì§„ëª©í‘œ": {
        "style": "íš¨ê³¼í˜•",
        "guide": "ë‹¬ì„±í•˜ê³ ìž í•˜ëŠ” ëª©í‘œë¥¼ ì •ëŸ‰ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ ê¸°ìˆ ",
        "example": "2026ë…„ ë§ê¹Œì§€ ê´€ë‚´ CCTV ì‚¬ê°ì§€ëŒ€ 38ê°œì†Œ ì¤‘ 30ê°œì†Œ(79%)ë¥¼ í•´ì†Œí•˜ê³ , ë…¸í›„ CCTV 274ëŒ€ ì¤‘ 150ëŒ€ë¥¼ ê³ í™”ì§ˆ ìž¥ë¹„ë¡œ êµì²´í•˜ì—¬ ì˜ìƒ í™œìš©ë¥ ì„ í˜„ìž¬ 65%ì—ì„œ 90%ê¹Œì§€ í–¥ìƒì‹œí‚¬ ê³„íšìž„"
    },
    "ê°œì„ ëª©í‘œ": {
        "style": "íš¨ê³¼í˜•",
        "guide": "ê°œì„ ì„ í†µí•´ ë‹¬ì„±í•˜ê³ ìž í•˜ëŠ” ëª©í‘œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ë…¸í›„ ìž¥ë¹„ êµì²´ ë° ì‹ ê·œ ì„¤ì¹˜ë¥¼ í†µí•´ CCTV ì˜ìƒí’ˆì§ˆì„ HDê¸‰ ì´ìƒìœ¼ë¡œ í–¥ìƒì‹œí‚¤ê³ , ì•¼ê°„ ì‹ë³„ë¥ ì„ í˜„ìž¬ 40%ì—ì„œ 85%ê¹Œì§€ ê°œì„ í•˜ì—¬ ë²”ì£„ ì˜ˆë°© ë° ê²€ê±° íš¨ìœ¨ì„±ì„ ë†’ì´ê³ ìž í•¨"
    },
    
    # ==================
    # ëŒ€ì±…/ë°©ì•ˆí˜• ì„¹ì…˜ (êµ¬ì²´ì  ì‹¤í–‰ë°©ì•ˆ ê¸°ìˆ )
    # ==================
    "ì¶”ì§„ê³„íš": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ë¬´ì—‡ì„, ì–´ë””ì—, ì–¼ë§ˆë‚˜ í•  ê²ƒì¸ì§€ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ë²”ì£„ ì·¨ì•½ì§€ì—­ 15ê°œì†Œì— ê³ í™”ì§ˆ(200ë§Œ í™”ì†Œ ì´ìƒ) CCTV 50ëŒ€ë¥¼ ì‹ ê·œ ì„¤ì¹˜í•˜ê³ , ê²½ì°°ì„œ ê´€ì œì„¼í„°ì™€ ì‹¤ì‹œê°„ ì˜ìƒ ì—°ê³„ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•  ê³„íšìž„. ì„¤ì¹˜ ëŒ€ìƒì§€ëŠ” ì£¼ë¯¼ ì˜ê²¬ìˆ˜ë ´ ë° ê²½ì°°ì„œ í˜‘ì˜ë¥¼ ê±°ì³ ìš°ì„ ìˆœìœ„ë¥¼ ì„ ì •í•¨"
    },
    "ì„¸ë¶€ë‚´ìš©": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ì¶”ì§„ê³„íšì˜ ì„¸ë¶€ ì‹¤í–‰ë°©ì•ˆì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "CCTV ì‚¬ì–‘ì€ 200ë§Œ í™”ì†Œ ì´ìƒ, ì•¼ê°„ ì ì™¸ì„  ê¸°ëŠ¥, 360ë„ íšŒì „í˜•ìœ¼ë¡œ ì„ ì •í•˜ê³ , ì €ìž¥ìž¥ì¹˜ëŠ” 30ì¼ ì´ìƒ ì˜ìƒ ë³´ê´€ì´ ê°€ëŠ¥í•œ 4TB ì´ìƒ ê·œê²©ì„ ì ìš©í•¨. ì„¤ì¹˜ ì§€ì ë³„ë¡œ ì „ë ¥ ë° í†µì‹  ì¸í”„ë¼ë¥¼ ì‚¬ì „ ì ê²€í•˜ì—¬ ì¶”ê°€ ê³µì‚¬ ì—¬ë¶€ë¥¼ í™•ì¸í•¨"
    },
    "ì„¸ë¶€ì¶”ì§„ê³„íš": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ë‹¨ê³„ë³„, ë¶„ì•¼ë³„ ì„¸ë¶€ ì¶”ì§„ë°©ì•ˆì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "1ë‹¨ê³„(1~3ì›”): ì„¤ê³„ìš©ì—­ ë° ëŒ€ìƒì§€ í™•ì •, 2ë‹¨ê³„(4~5ì›”): ìž¥ë¹„ êµ¬ë§¤ ë° ì„¤ì¹˜ê³µì‚¬, 3ë‹¨ê³„(6ì›”): ì‹œìš´ì „ ë° ê²½ì°°ì„œ ì—°ê³„. ì„¤ì¹˜ ì™„ë£Œ í›„ 1ê°œì›”ê°„ ì‹œë²”ìš´ì˜ì„ í†µí•´ ë¬¸ì œì ì„ ë³´ì™„í•œ ë’¤ ì •ì‹ ìš´ì˜ì„ ê°œì‹œí•¨"
    },
    "ê°œì„ ëŒ€ì±…": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ë¬¸ì œ í•´ê²°ì„ ìœ„í•œ êµ¬ì²´ì  ëŒ€ì±…ì„ ê¸°ìˆ ",
        "example": "ë…¸í›„ CCTV êµì²´ ì‚¬ì—…ì„ ì—°ì°¨ë³„ë¡œ ì¶”ì§„í•˜ì—¬ 2028ë…„ê¹Œì§€ ì „ì²´ ìž¥ë¹„ì˜ HDê¸‰ ì „í™˜ì„ ì™„ë£Œí•˜ê³ , ì•¼ê°„ ì·¨ì•½ì§€ì—­ì—ëŠ” ë³´ì•ˆë“±ê³¼ CCTVë¥¼ ì—°ê³„ ì„¤ì¹˜í•˜ì—¬ ì•¼ê°„ ì‹ë³„ë¥ ì„ ê°œì„ í•¨"
    },
    "ëŒ€ì‘ë°©ì•ˆ": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ìœ„í—˜ìš”ì†Œë‚˜ ë¬¸ì œì— ëŒ€í•œ ëŒ€ì‘ë°©ì•ˆì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ê¸´ê¸‰ ìƒí™© ë°œìƒ ì‹œ í†µí•©ê´€ì œì„¼í„°ì—ì„œ ê²½ì°°ì„œë¡œ ì¦‰ì‹œ ì˜ìƒì„ ì „ì†¡í•˜ê³ , í˜„ìž¥ ì¶œë™ ê²½ì°°ê´€ì—ê²Œ ì‹¤ì‹œê°„ ìœ„ì¹˜ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì²´ê³„ë¥¼ êµ¬ì¶•í•¨. ìž¥ë¹„ ê³ ìž¥ ì‹œ 24ì‹œê°„ ë‚´ A/Sê°€ ê°€ëŠ¥í•˜ë„ë¡ ìœ ì§€ë³´ìˆ˜ ê³„ì•½ì„ ì²´ê²°í•¨"
    },
    "ê°œì„ ë°©ì•ˆ": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "í˜„ìž¬ ë¬¸ì œì ì„ ê°œì„ í•˜ê¸° ìœ„í•œ êµ¬ì²´ì  ë°©ì•ˆ ê¸°ìˆ ",
        "example": "ì˜ìƒ í™”ì§ˆ ê°œì„ ì„ ìœ„í•´ ê¸°ì¡´ SDê¸‰ ìž¥ë¹„ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ HDê¸‰ìœ¼ë¡œ êµì²´í•˜ê³ , ì•¼ê°„ ì´¬ì˜ í’ˆì§ˆ í–¥ìƒì„ ìœ„í•´ ì ì™¸ì„  ì¡°ëª…ìž¥ì¹˜ë¥¼ ì¶”ê°€ ì„¤ì¹˜í•¨. ë˜í•œ AI ì˜ìƒë¶„ì„ ê¸°ëŠ¥ì„ ë„ìž…í•˜ì—¬ ì´ìƒí–‰ë™ ìžë™ ê°ì§€ ì²´ê³„ë¥¼ êµ¬ì¶•í•¨"
    },
    "ì¡°ì¹˜ì‚¬í•­": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ì´ë¯¸ ì·¨í•œ ì¡°ì¹˜ ë˜ëŠ” ì·¨í•  ì¡°ì¹˜ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ì‚¬ê³  ë°œìƒ ì¦‰ì‹œ í˜„ìž¥ì— ë‹´ë‹¹ ì§ì›ì„ íŒŒê²¬í•˜ì—¬ ìƒí™©ì„ íŒŒì•…í•˜ê³ , í”¼í•´ìž ì§€ì› ë° 2ì°¨ ì‚¬ê³  ì˜ˆë°©ì„ ìœ„í•œ ì•ˆì „ì¡°ì¹˜ë¥¼ ì‹œí–‰í•¨. ê´€ê³„ê¸°ê´€(ê²½ì°°ì„œ, ì†Œë°©ì„œ)ì— ìƒí™©ì„ í†µë³´í•˜ê³  ê³µë™ ëŒ€ì‘ ì²´ê³„ë¥¼ ê°€ë™í•¨"
    },
    "í›„ì†ëŒ€ì±…": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "í–¥í›„ ì·¨í•  í›„ì† ì¡°ì¹˜ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ìœ ì‚¬ ì‚¬ê³  ìž¬ë°œ ë°©ì§€ë¥¼ ìœ„í•´ í•´ë‹¹ êµ¬ê°„ì— ê³¼ì†ë°©ì§€í„± ë° ë³´í–‰ìž ì•ˆì „ì‹œì„¤ì„ ì¶”ê°€ ì„¤ì¹˜í•˜ê³ , ì‚¬ê³ ë‹¤ë°œì§€ì  ì•ˆë‚´í‘œì§€ë¥¼ ì„¤ì¹˜í•˜ì—¬ ìš´ì „ìž ì£¼ì˜ë¥¼ í™˜ê¸°ì‹œí‚¬ ê³„íšìž„"
    },
    
    # ==================
    # ë¶„ì„/ì§„ë‹¨í˜• ì„¹ì…˜ (ê°ê´€ì  ë¶„ì„ ê²°ê³¼ ê¸°ìˆ )
    # ==================
    "í˜„ìƒì§„ë‹¨": {
        "style": "ë¶„ì„í˜•",
        "guide": "í˜„ìž¬ ìƒí™©ì„ ê°ê´€ì ìœ¼ë¡œ ì§„ë‹¨í•˜ê³  ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ìˆ ",
        "example": "ê´€ë‚´ ë°©ë²” ì¸í”„ë¼ í˜„í™©ì„ ì§„ë‹¨í•œ ê²°ê³¼, CCTV ì„¤ì¹˜ ë°€ë„ëŠ” ë„ë‚´ í‰ê·  ëŒ€ë¹„ 28% ë‚®ê³ , íŠ¹ížˆ ì‹ ê·œ ê°œë°œì§€ì—­ì˜ ë°©ë²”ì‹œì„¤ ì„¤ì¹˜ìœ¨ì´ 42%ì— ë¶ˆê³¼í•œ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¨"
    },
    "ë¬¸ì œë¶„ì„": {
        "style": "ë¶„ì„í˜•",
        "guide": "ë¬¸ì œì˜ ì›ì¸ì„ ë¶„ì„í•˜ì—¬ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ë²”ì£„ ë°œìƒë¥  ì¦ê°€ì˜ ì£¼ìš” ì›ì¸ì„ ë¶„ì„í•œ ê²°ê³¼, ì²«ì§¸ CCTV ì‚¬ê°ì§€ëŒ€ ì¦ê°€, ë‘˜ì§¸ ì•¼ê°„ ì¡°ëª… ë¶€ì¡±, ì…‹ì§¸ ìˆœì°° ì¸ë ¥ ë¶€ì¡± ìˆœìœ¼ë¡œ íŒŒì•…ë¨. íŠ¹ížˆ ì‹ ê·œ íƒì§€ì§€êµ¬ì˜ ê²½ìš° ìž…ì£¼ í›„ ë°©ë²”ì‹œì„¤ ì„¤ì¹˜ê°€ ì§€ì—°ë˜ì–´ ë²”ì£„ ì·¨ì•½ì„±ì´ ë†’ì•„ì§„ ê²ƒìœ¼ë¡œ ë¶„ì„ë¨"
    },
    "ìœ„í—˜ìš”ì†Œ": {
        "style": "ë¶„ì„í˜•",
        "guide": "ìž ìž¬ì  ìœ„í—˜ìš”ì†Œë¥¼ ì‹ë³„í•˜ê³  ë¶„ì„ ê²°ê³¼ë¥¼ ê¸°ìˆ ",
        "example": "ì‚¬ì—… ì¶”ì§„ ì‹œ ì˜ˆìƒë˜ëŠ” ìœ„í—˜ìš”ì†Œë¡œëŠ” ì²«ì§¸ ì˜ˆì‚° í™•ë³´ ì§€ì—°(ê°€ëŠ¥ì„± 30%), ë‘˜ì§¸ ë¯¼ì› ë°œìƒ(ì„¤ì¹˜ ë°˜ëŒ€), ì…‹ì§¸ ê³µì‚¬ ì§€ì—°(ë™ì ˆê¸° ìž‘ì—… ì œí•œ) ë“±ì´ ìžˆìœ¼ë©°, ê° ìœ„í—˜ìš”ì†Œë³„ ëŒ€ì‘ë°©ì•ˆì„ ì‚¬ì „ì— ë§ˆë ¨í•  í•„ìš”ê°€ ìžˆìŒ"
    },
    "ë¶„ì„ê²°ê³¼": {
        "style": "ë¶„ì„í˜•",
        "guide": "ë°ì´í„° ë¶„ì„ ê²°ê³¼ë¥¼ ê°ê´€ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ ê¸°ìˆ ",
        "example": "ìµœê·¼ 3ë…„ê°„ ë²”ì£„ ë°œìƒ ë°ì´í„°ë¥¼ ë¶„ì„í•œ ê²°ê³¼, CCTV ì„¤ì¹˜ ì§€ì—­ì˜ ë²”ì£„ ë°œìƒë¥ ì´ ë¯¸ì„¤ì¹˜ ì§€ì—­ ëŒ€ë¹„ í‰ê·  35% ë‚®ì€ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ìœ¼ë©°, íŠ¹ížˆ ì•¼ê°„ ì‹œê°„ëŒ€(22ì‹œ~06ì‹œ) íš¨ê³¼ê°€ ë”ìš± ëšœë ·í•¨(42% ê°ì†Œ)"
    },
    "ì‹œì‚¬ì ": {
        "style": "ë¶„ì„í˜•",
        "guide": "ë¶„ì„ ê²°ê³¼ì—ì„œ ë„ì¶œëœ ì‹œì‚¬ì ì„ ê¸°ìˆ ",
        "example": "ì´ë²ˆ ë¶„ì„ì„ í†µí•´ CCTV ì„¤ì¹˜ì˜ ë²”ì£„ ì˜ˆë°© íš¨ê³¼ê°€ ì‹¤ì¦ì ìœ¼ë¡œ í™•ì¸ë˜ì—ˆìœ¼ë©°, íŠ¹ížˆ ì•¼ê°„ ì·¨ì•½ì§€ì—­ì— ëŒ€í•œ ìš°ì„  ì„¤ì¹˜ê°€ íš¨ê³¼ì ìž„ì„ ì•Œ ìˆ˜ ìžˆìŒ. í–¥í›„ CCTV ì„¤ì¹˜ ê³„íš ìˆ˜ë¦½ ì‹œ ë²”ì£„ ë°œìƒ ë¹ˆë„ì™€ ì‹œê°„ëŒ€ë¥¼ ê³ ë ¤í•œ ì „ëžµì  ë°°ì¹˜ê°€ í•„ìš”í•¨"
    },
    "ì£¼ìš”ë™í–¥": {
        "style": "ë¶„ì„í˜•",
        "guide": "ê´€ë ¨ ë¶„ì•¼ì˜ ìµœì‹  ë™í–¥ì„ ê°ê´€ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ìµœê·¼ ìŠ¤ë§ˆíŠ¸ì‹œí‹° ì¶”ì§„ì— ë”°ë¼ ì „êµ­ ì§€ìžì²´ì—ì„œ AI ê¸°ë°˜ ì˜ìƒë¶„ì„ CCTV ë„ìž…ì´ í™•ëŒ€ë˜ê³  ìžˆìœ¼ë©°, í–‰ì•ˆë¶€ì—ì„œë„ 2026ë…„ê¹Œì§€ ì „êµ­ í†µí•©ê´€ì œì„¼í„°ì˜ AI ì „í™˜ì„ ê¶Œê³ í•˜ê³  ìžˆìŒ"
    },
    "ì˜í–¥ë¶„ì„": {
        "style": "ë¶„ì„í˜•",
        "guide": "ì •ì±…ì´ë‚˜ ì‚¬ì—…ì´ ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•˜ì—¬ ê¸°ìˆ ",
        "example": "CCTV ì¶”ê°€ ì„¤ì¹˜ ì‹œ ì˜ˆìƒë˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•œ ê²°ê³¼, ê¸ì •ì  ì¸¡ë©´ìœ¼ë¡œëŠ” ë²”ì£„ ì˜ˆë°© íš¨ê³¼ ë° ì£¼ë¯¼ ì•ˆì‹¬ íš¨ê³¼ê°€ ìžˆìœ¼ë©°, ë¶€ì •ì  ì¸¡ë©´ìœ¼ë¡œëŠ” ì‚¬ìƒí™œ ì¹¨í•´ ìš°ë ¤ ë° ìœ ì§€ê´€ë¦¬ ë¹„ìš© ì¦ê°€ê°€ ì˜ˆìƒë¨"
    },
    
    # ==================
    # ê¸°íƒ€ ì„¹ì…˜
    # ==================
    "ì¶”ì§„ì „ëžµ": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•œ ì „ëžµì  ì ‘ê·¼ë°©ë²•ì„ ê¸°ìˆ ",
        "example": "3ëŒ€ ì¶”ì§„ì „ëžµìœ¼ë¡œ ì²«ì§¸ ë²”ì£„ ì·¨ì•½ì§€ì—­ ìš°ì„  ì„¤ì¹˜, ë‘˜ì§¸ ê²½ì°°ì„œ ì—°ê³„ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì²´ê³„ êµ¬ì¶•, ì…‹ì§¸ AI ì˜ìƒë¶„ì„ ê¸°ìˆ  ë‹¨ê³„ì  ë„ìž…ì„ ì„¤ì •í•˜ê³ , ì´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì‚¬ì—…ì„ ì¶”ì§„í•¨"
    },
    "ì§„í–‰í˜„í™©": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ì§„í–‰ ìƒí™©ì„ êµ¬ì²´ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ ê¸°ìˆ ",
        "example": "í˜„ìž¬ ì „ì²´ ì‚¬ì—…ì˜ 60%ê°€ ì™„ë£Œëœ ìƒíƒœë¡œ, ìž¥ë¹„ êµ¬ë§¤(100% ì™„ë£Œ), ì„¤ì¹˜ê³µì‚¬(50% ì§„í–‰ ì¤‘), ë„¤íŠ¸ì›Œí¬ êµ¬ì¶•(70% ì™„ë£Œ) ë“± ëŒ€ë¶€ë¶„ì˜ ê³µì •ì´ ê³„íšëŒ€ë¡œ ì¶”ì§„ë˜ê³  ìžˆìŒ"
    },
    "ì£¼ìš”ì„±ê³¼": {
        "style": "íš¨ê³¼í˜•",
        "guide": "ê·¸ë™ì•ˆì˜ ì£¼ìš” ì„±ê³¼ë¥¼ ì •ëŸ‰ì  ìˆ˜ì¹˜ì™€ í•¨ê»˜ ê¸°ìˆ ",
        "example": "ê¸ˆë…„ë„ CCTV ì„¤ì¹˜ì‚¬ì—… ì¶”ì§„ ê²°ê³¼, ëª©í‘œ ëŒ€ë¹„ 120%ë¥¼ ë‹¬ì„±(ëª©í‘œ 40ëŒ€, ì‹¤ì  48ëŒ€)í•˜ì˜€ìœ¼ë©°, ì„¤ì¹˜ ì™„ë£Œ ì§€ì—­ì˜ ë²”ì£„ ë°œìƒë¥ ì´ ì „ë…„ ë™ê¸° ëŒ€ë¹„ 18% ê°ì†Œí•˜ëŠ” ì„±ê³¼ë¥¼ ê±°ë‘ "
    },
    "í–¥í›„ê³„íš": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "í–¥í›„ ì¶”ì§„í•  ê³„íšì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "2026ë…„ í•˜ë°˜ê¸°ì—ëŠ” 1ë‹¨ê³„ ì„¤ì¹˜ ì§€ì—­ì˜ ìš´ì˜ ì„±ê³¼ë¥¼ ë¶„ì„í•˜ì—¬ 2ë‹¨ê³„ ì„¤ì¹˜ ëŒ€ìƒì§€ë¥¼ ì„ ì •í•˜ê³ , AI ì˜ìƒë¶„ì„ ê¸°ëŠ¥ ë„ìž…ì„ ìœ„í•œ ì‹œë²”ì‚¬ì—…ì„ ì¶”ì§„í•  ê³„íšìž„"
    },
    "í˜„ìž¬ìƒíƒœ": {
        "style": "ì„œìˆ í˜•",
        "guide": "í˜„ìž¬ ìƒíƒœë¥¼ ê°ê´€ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "í˜„ìž¬ ì‚¬ê³  í˜„ìž¥ì€ ì •ë¦¬ê°€ ì™„ë£Œë˜ì–´ ì •ìƒ í†µí–‰ì´ ê°€ëŠ¥í•˜ë©°, í”¼í•´ ì°¨ëŸ‰ì€ ê²¬ì¸ ì¡°ì¹˜ë¨. ë¶€ìƒìžëŠ” ì¸ê·¼ â—‹â—‹ë³‘ì›ì—ì„œ ì¹˜ë£Œ ì¤‘ì´ë©° ìƒëª…ì—ëŠ” ì§€ìž¥ì´ ì—†ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë¨"
    },
    "í”¼í•´ìƒí™©": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "í”¼í•´ í˜„í™©ì„ ìœ í˜•ë³„ë¡œ ì •ë¦¬í•˜ì—¬ ê¸°ìˆ ",
        "example": "ì¸ëª…í”¼í•´: ê²½ìƒ 2ëª…(â—‹â—‹ë³‘ì› ì¹˜ë£Œ ì¤‘) / ìž¬ì‚°í”¼í•´: ì°¨ëŸ‰ 2ëŒ€ íŒŒì†, ê°€ë¡œë“± 1ê¸° íŒŒì† / êµí†µì˜í–¥: í•´ë‹¹ êµ¬ê°„ 30ë¶„ê°„ êµí†µ í†µì œ"
    },
    "ê²°ì •ì‚¬í•­": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "íšŒì˜ì—ì„œ ê²°ì •ëœ ì‚¬í•­ì„ í•­ëª©ë³„ë¡œ ì •ë¦¬",
        "example": "CCTV ì„¤ì¹˜ ëŒ€ìƒì§€: ì›ì•ˆ ì˜ê²°(15ê°œì†Œ) / ì‚¬ì—… ì˜ˆì‚°: 3ì–µì› í™•ì • / ì¶”ì§„ì¼ì •: ìƒë°˜ê¸° ì™„ë£Œ ëª©í‘œ / ë‹´ë‹¹ë¶€ì„œ: â—‹â—‹ê³¼"
    },
    "ì£¼ìš”ë…¼ì˜ì‚¬í•­": {
        "style": "ì„œìˆ í˜•",
        "guide": "íšŒì˜ì—ì„œ ë…¼ì˜ëœ ì£¼ìš” ë‚´ìš©ì„ ì •ë¦¬",
        "example": "CCTV ì„¤ì¹˜ ìœ„ì¹˜ ì„ ì • ê¸°ì¤€ì— ëŒ€í•´ ë…¼ì˜í•˜ì˜€ìœ¼ë©°, ë²”ì£„ ë°œìƒ ë¹ˆë„, ì£¼ë¯¼ ìš”ì²­, ê²½ì°°ì„œ ì˜ê²¬ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì—¬ ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•˜ê¸°ë¡œ í•¨. ì˜ˆì‚° ë²”ìœ„ ë‚´ì—ì„œ ìµœëŒ€í•œ ë§Žì€ ì§€ì ì— ì„¤ì¹˜í•˜ë˜ í’ˆì§ˆì„ ì €í•˜ì‹œí‚¤ì§€ ì•ŠëŠ” ë°©í–¥ìœ¼ë¡œ ì¶”ì§„í•˜ê¸°ë¡œ ì˜ê²¬ì„ ëª¨ìŒ"
    },
    "íšŒì˜ì•ˆê±´": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "íšŒì˜ ì•ˆê±´ì„ ê°„ê²°í•˜ê²Œ ë‚˜ì—´",
        "example": "ì•ˆê±´1: 2026ë…„ CCTV ì„¤ì¹˜ ëŒ€ìƒì§€ ì„ ì • / ì•ˆê±´2: ì‚¬ì—… ì˜ˆì‚° ë° ì¶”ì§„ì¼ì • í™•ì • / ì•ˆê±´3: ê´€ê³„ê¸°ê´€ í˜‘ì¡°ì‚¬í•­ ë…¼ì˜"
    },
    "ë¶„ì„ëª©ì ": {
        "style": "ì„œìˆ í˜•",
        "guide": "ë¶„ì„ì„ ìˆ˜í–‰í•˜ëŠ” ëª©ì ì„ ê¸°ìˆ ",
        "example": "ë³¸ ë¶„ì„ì€ ê´€ë‚´ CCTV ì„¤ì¹˜ íš¨ê³¼ë¥¼ ì‹¤ì¦ì ìœ¼ë¡œ ê²€ì¦í•˜ê³ , í–¥í›„ ì„¤ì¹˜ ê³„íš ìˆ˜ë¦½ ì‹œ ì°¸ê³ ìžë£Œë¡œ í™œìš©í•˜ê¸° ìœ„í•´ ìˆ˜í–‰í•¨"
    },
    "ë¶„ì„ë°©ë²•": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë¶„ì„ì— ì‚¬ìš©í•œ ë°©ë²•ë¡ ì„ ê¸°ìˆ ",
        "example": "ë¶„ì„ê¸°ê°„: 2023~2025ë…„(3ê°œë…„) / ë¶„ì„ëŒ€ìƒ: ê´€ë‚´ ì „ì²´ CCTV ì„¤ì¹˜ì§€ì—­ / ë¶„ì„ë°©ë²•: ë²”ì£„ ë°œìƒ ê±´ìˆ˜ ë¹„êµë¶„ì„, ì‹œê³„ì—´ ë¶„ì„"
    },
    "ë°ì´í„°ê°œìš”": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë¶„ì„ì— ì‚¬ìš©í•œ ë°ì´í„° ê°œìš”ë¥¼ ê¸°ìˆ ",
        "example": "ë°ì´í„° ì¶œì²˜: ê²½ì°°ì²­ ë²”ì£„í†µê³„, ì‹œ CCTV ê´€ì œì„¼í„° / ë°ì´í„° ê±´ìˆ˜: ì´ 15,234ê±´ / ë°ì´í„° ê¸°ê°„: 2023. 1. ~ 2025. 12."
    },
    "ê²°ë¡ ": {
        "style": "íš¨ê³¼í˜•",
        "guide": "ë¶„ì„ì´ë‚˜ ê²€í† ì˜ ìµœì¢… ê²°ë¡ ì„ ê¸°ìˆ ",
        "example": "ë¶„ì„ ê²°ê³¼ë¥¼ ì¢…í•©í•˜ë©´ CCTV ì„¤ì¹˜ëŠ” ë²”ì£„ ì˜ˆë°©ì— ì‹¤ì§ˆì ì¸ íš¨ê³¼ê°€ ìžˆìœ¼ë©°, íŠ¹ížˆ ì•¼ê°„ ì·¨ì•½ì§€ì—­ì— ëŒ€í•œ ì „ëžµì  ì„¤ì¹˜ê°€ ì¤‘ìš”í•¨. í–¥í›„ AI ì˜ìƒë¶„ì„ ê¸°ìˆ ì„ ì ‘ëª©í•˜ì—¬ íš¨ê³¼ë¥¼ ê·¹ëŒ€í™”í•  í•„ìš”ê°€ ìžˆìŒ"
    },
    "ì„±ê³¼ì§€í‘œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ì„±ê³¼ë¥¼ ì¸¡ì •í•˜ëŠ” ì§€í‘œë¥¼ ë‚˜ì—´",
        "example": "ì •ëŸ‰ì§€í‘œ: ë²”ì£„ ë°œìƒ ê±´ìˆ˜, ê²€ê±°ìœ¨, CCTV ê°€ë™ë¥  / ì •ì„±ì§€í‘œ: ì£¼ë¯¼ ì²´ê°ì•ˆì „ë„, ë§Œì¡±ë„ ì¡°ì‚¬ ê²°ê³¼"
    },
    "ê°œì„ ì‚¬í•­": {
        "style": "ë°©ì•ˆí˜•",
        "guide": "ê°œì„ ì´ í•„ìš”í•œ ì‚¬í•­ê³¼ ë°©ì•ˆì„ ê¸°ìˆ ",
        "example": "ì˜ìƒ ì €ìž¥ê¸°ê°„ì´ í˜„ìž¬ 15ì¼ë¡œ ìˆ˜ì‚¬ í™œìš©ì— ì œí•œì´ ìžˆì–´ 30ì¼ë¡œ ì—°ìž¥ì´ í•„ìš”í•˜ë©°, ì•¼ê°„ í™”ì§ˆ ê°œì„ ì„ ìœ„í•´ ì ì™¸ì„  ì„±ëŠ¥ì´ ê°•í™”ëœ ìž¥ë¹„ë¡œ ìˆœì°¨ êµì²´ê°€ í•„ìš”í•¨"
    },
    "ë¶„ì„ë°°ê²½": {
        "style": "ì„œìˆ í˜•",
        "guide": "ë¶„ì„ì„ ìˆ˜í–‰í•˜ê²Œ ëœ ë°°ê²½ì„ ê¸°ìˆ ",
        "example": "ìµœê·¼ ìŠ¤ë§ˆíŠ¸ì‹œí‹° ì¶”ì§„ì— ë”°ë¥¸ CCTV ê³ ë„í™” ì •ì±…ì´ í™•ëŒ€ë˜ê³  ìžˆì–´, ìš°ë¦¬ ì‹œì˜ í˜„í™©ì„ ì ê²€í•˜ê³  í–¥í›„ ë°œì „ë°©í–¥ì„ ëª¨ìƒ‰í•˜ê³ ìž ë³¸ ë¶„ì„ì„ ìˆ˜í–‰í•¨"
    },
    "íŠ¹ì´ì‚¬í•­": {
        "style": "ì„œìˆ í˜•",
        "guide": "íŠ¹ë³„ížˆ ë³´ê³ ê°€ í•„ìš”í•œ ì‚¬í•­ì„ ê¸°ìˆ ",
        "example": "ê¸ˆì¼ â—‹â—‹ë™ ì¼ëŒ€ì—ì„œ ë‹¨ìˆ˜ê°€ ë°œìƒí•˜ì—¬ ì£¼ë¯¼ ë¶ˆíŽ¸ì´ ì˜ˆìƒë˜ë©°, ë³µêµ¬ìž‘ì—…ì€ 18:00ê²½ ì™„ë£Œë  ì˜ˆì •ìž„. í•´ë‹¹ ì§€ì—­ ì£¼ë¯¼ì—ê²Œ ê°œë³„ ë¬¸ìž ì•ˆë‚´ë¥¼ ì™„ë£Œí•¨"
    },
    "í›„ì†ì¡°ì¹˜": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "í–¥í›„ ì¡°ì¹˜í•  ì‚¬í•­ì„ ê°„ê²°í•˜ê²Œ ë‚˜ì—´",
        "example": "í”¼í•´ìž ì§€ì›: ì˜ë£Œë¹„ ì§€ì› ê²€í†  / ìž¬ë°œë°©ì§€: í•´ë‹¹ êµ¬ê°„ ì•ˆì „ì‹œì„¤ ì ê²€ / ë³´ê³ : ìƒí™© ì¢…ë£Œ ì‹œ ìµœì¢… ê²°ê³¼ ë³´ê³ "
    },
    "ë‚ ì§œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë‚ ì§œì™€ ê´€ë ¨ ì •ë³´ë¥¼ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ìž‘ì„±ì¼: 2026. 1. 27.(ì›”) / ìž‘ì„±ìž: â—‹â—‹ê³¼ â—‹â—‹â—‹"
    },
    "ì£¼ìš”ë‚´ìš©": {
        "style": "ì„œìˆ í˜•",
        "guide": "í•µì‹¬ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ê¸ˆì¼ â—‹â—‹ ê´€ë ¨ ë¯¼ì›ì´ 3ê±´ ì ‘ìˆ˜ë˜ì—ˆìœ¼ë©°, ëª¨ë‘ ë™ì¼ ì‚¬ì•ˆì— ëŒ€í•œ ì¤‘ë³µ ë¯¼ì›ìœ¼ë¡œ í™•ì¸ë¨. ë‹´ë‹¹ ë¶€ì„œì—ì„œ ì¼ê´„ íšŒì‹  ì˜ˆì •ìž„"
    },
    "ì—…ë¬´ê°œìš”": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì—…ë¬´ì˜ ì „ì²´ì ì¸ ê°œìš”ë¥¼ ê¸°ìˆ ",
        "example": "â—‹â—‹ì‚¬ì—… ê´€ë ¨ ì¤‘ê°„ë³´ê³  ìžë£Œ ìž‘ì„± ë° ì œì¶œ ì—…ë¬´ë¡œ, ì‚¬ì—… ì¶”ì§„í˜„í™©ê³¼ í–¥í›„ ê³„íšì„ ì •ë¦¬í•˜ì—¬ ë„ì²­ì— ë³´ê³ í•¨"
    },
    "ì²˜ë¦¬ë‚´ìš©": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì²˜ë¦¬í•œ ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ìš”ì²­ë°›ì€ ìžë£Œë¥¼ ì·¨í•©í•˜ì—¬ ì •í•´ì§„ ì–‘ì‹ì— ë§žê²Œ ìž‘ì„± ì™„ë£Œí•˜ì˜€ìœ¼ë©°, ê³¼ìž¥ ê²°ìž¬ í›„ ë„ì²­ ë‹´ë‹¹ìžì—ê²Œ ì´ë©”ì¼ë¡œ ì œì¶œí•¨"
    },
    "ì°¸ê³ ì‚¬í•­": {
        "style": "ì„œìˆ í˜•",
        "guide": "ì°¸ê³ ê°€ í•„ìš”í•œ ì‚¬í•­ì„ ê¸°ìˆ ",
        "example": "ë‹¤ìŒ ë¶„ê¸° ë³´ê³  ì‹œì—ëŠ” ì„±ê³¼ì§€í‘œ ë‹¬ì„±í˜„í™©ë„ í•¨ê»˜ ì œì¶œí•´ì•¼ í•˜ë¯€ë¡œ ê´€ë ¨ ë°ì´í„° ìˆ˜ì§‘ì´ í•„ìš”í•¨"
    },
    "ìž‘ì„±ì¼": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ìž‘ì„±ì¼ê³¼ ê´€ë ¨ ì •ë³´ë¥¼ ê°„ê²°í•˜ê²Œ ê¸°ìˆ ",
        "example": "ìž‘ì„±ì¼: 2026. 1. 27.(ì›”) / ìž‘ì„±ìž: â—‹â—‹ê³¼ â—‹â—‹â—‹ ì£¼ë¬´ê´€"
    },
    "ë°œìƒìž¥ì†Œ": {
        "style": "ë‚˜ì—´í˜•",
        "guide": "ë°œìƒ ìž¥ì†Œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ ",
        "example": "ìž¥ì†Œ: â—‹â—‹ì‹œ â—‹â—‹ë™ â—‹â—‹ë¡œ 123(â—‹â—‹ì•„íŒŒíŠ¸ ì•ž ì‚¬ê±°ë¦¬) / ê´€í• : â—‹â—‹íŒŒì¶œì†Œ"
    },
}


# ===========================================
# ðŸŽ¯ í”„ë¡¬í”„íŠ¸ ìƒì„± í•¨ìˆ˜
# ===========================================
def build_prompt(title: str, report_type: str, detail_type: str, keywords: str, length_key: str) -> str:
    """ì„¹ì…˜ë³„ íŠ¹ì„±ì„ ë°˜ì˜í•œ í”„ë¡¬í”„íŠ¸ ìƒì„±"""
    
    sections = REPORT_STRUCTURES[report_type][detail_type]
    rule = LENGTH_RULES[length_key]
    keyword_list = [kw.strip() for kw in keywords.split(",") if kw.strip()]
    
    # ì„¹ì…˜ë³„ ê°€ì´ë“œ ìƒì„±
    section_guides = []
    for sec in sections:
        if sec in SECTION_STYLES:
            style_info = SECTION_STYLES[sec]
            section_guides.append(f"""
### {sec} ({style_info['style']})
- ìž‘ì„±ë°©ë²•: {style_info['guide']}
- ì˜ˆì‹œ: "{style_info['example']}"
""")
        else:
            section_guides.append(f"""
### {sec}
- ìž‘ì„±ë°©ë²•: í•´ë‹¹ ë‚´ìš©ì„ êµ¬ì²´ì ìœ¼ë¡œ ê¸°ìˆ 
""")
    
    section_guide_text = "\n".join(section_guides)
    
    return f"""ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ì§€ë°©ìžì¹˜ë‹¨ì²´ì—ì„œ 15ë…„ê°„ ê·¼ë¬´í•œ 7ê¸‰ ê³µë¬´ì›ìž…ë‹ˆë‹¤.
ì‹¤ì œ ì—…ë¬´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìˆ˜ì¤€ì˜ ë³´ê³ ì„œë¥¼ ìž‘ì„±í•´ì£¼ì„¸ìš”.

## ìž‘ì„±í•  ë³´ê³ ì„œ ì •ë³´
- ì œëª©: {title}
- ìœ í˜•: {report_type} > {detail_type}
- í•µì‹¬ í‚¤ì›Œë“œ: {', '.join(keyword_list)}
- ë¶„ëŸ‰: ì„¹ì…˜ë‹¹ {rule['items_per_section']}ê°œ í•­ëª©

## ì„¹ì…˜ êµ¬ì„±
{' â†’ '.join(sections)}

## ë¬¸ì²´ ê·œì¹™ (ê°œê´„ì‹ ì¢…ê²°ì–´ë¯¸)
- ì„œìˆ í˜• ì„¹ì…˜: "~ìž„", "~ìŒ", "~í•¨", "~ë¨" ë“±ìœ¼ë¡œ ë¬¸ìž¥ ì¢…ê²°
- ë‚˜ì—´í˜• ì„¹ì…˜: "í•­ëª©: ë‚´ìš©" í˜•íƒœë¡œ ê°„ê²°í•˜ê²Œ (ë¬¸ìž¥í˜• ì¢…ê²°ì–´ë¯¸ ë¶ˆí•„ìš”)
- ì ˆëŒ€ ê¸ˆì§€: "~í–ˆìŠµë‹ˆë‹¤", "~í•©ë‹ˆë‹¤", "~í–ˆë‹¤", "~í•œë‹¤"

## í•µì‹¬ ê·œì¹™
1. í‚¤ì›Œë“œ "{', '.join(keyword_list)}"ë¥¼ ë°˜ë“œì‹œ ë‚´ìš©ì— ìžì—°ìŠ¤ëŸ½ê²Œ í¬í•¨
2. êµ¬ì²´ì  ìˆ«ìž(ìˆ˜ëŸ‰, ê¸ˆì•¡, ì¼ì •, ë¹„ìœ¨ ë“±)ë¥¼ ë°˜ë“œì‹œ í¬í•¨
3. ê° ì„¹ì…˜ì˜ ìŠ¤íƒ€ì¼(ì„œìˆ í˜•/ë‚˜ì—´í˜•/íš¨ê³¼í˜•/ë°©ì•ˆí˜•/ë¶„ì„í˜•)ì— ë§žê²Œ ìž‘ì„±
4. ì„¹ì…˜ ê°„ ë‚´ìš© ì¤‘ë³µ ê¸ˆì§€

## ì„¹ì…˜ë³„ ìž‘ì„± ê°€ì´ë“œ
{section_guide_text}

## ì¶œë ¥ í˜•ì‹
ë§ˆí¬ë‹¤ìš´, ì´ëª¨ì§€, ë¶ˆë¦¿ ê¸°í˜¸ ì—†ì´ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.

{{
  "title": "{title}",
  "type": "{report_type}",
  "detailType": "{detail_type}",
  "summary": "ë³´ê³ ì„œ í•µì‹¬ ë‚´ìš©ì„ 3~4ë¬¸ìž¥ìœ¼ë¡œ ìš”ì•½ (êµ¬ì²´ì  ìˆ˜ì¹˜ í¬í•¨, ê°œê´„ì‹ ì¢…ê²°ì–´ë¯¸)",
  "sections": [
    {{
      "title": "ì„¹ì…˜ëª…",
      "order": 1,
      "content": [
        "ì²« ë²ˆì§¸ í•­ëª© - í•´ë‹¹ ì„¹ì…˜ ìŠ¤íƒ€ì¼ì— ë§žê²Œ ìž‘ì„±",
        "ë‘ ë²ˆì§¸ í•­ëª©",
        "ì„¸ ë²ˆì§¸ í•­ëª©",
        "ë„¤ ë²ˆì§¸ í•­ëª©"
      ]
    }}
  ],
  "metadata": {{
    "generatedAt": "{datetime.now().isoformat()}",
    "totalSections": {len(sections)},
    "keywords": {json.dumps(keyword_list, ensure_ascii=False)}
  }}
}}
"""


# ===========================================
# ðŸ”§ í›„ì²˜ë¦¬ í•¨ìˆ˜
# ===========================================
TERM_CORRECTIONS = {
    "í–ˆìŠµë‹ˆë‹¤": "í•˜ì˜€ìŒ",
    "í•©ë‹ˆë‹¤": "í•¨",
    "ë©ë‹ˆë‹¤": "ë¨",
    "ìž…ë‹ˆë‹¤": "ìž„",
    "ìžˆìŠµë‹ˆë‹¤": "ìžˆìŒ",
    "ì—†ìŠµë‹ˆë‹¤": "ì—†ìŒ",
    "í–ˆë‹¤": "í•˜ì˜€ìŒ",
    "í•œë‹¤": "í•¨",
    "ëœë‹¤": "ë¨",
    "ì´ë‹¤": "ìž„",
    "ìžˆë‹¤": "ìžˆìŒ",
    "ì—†ë‹¤": "ì—†ìŒ",
    "í•˜ê² ìŠµë‹ˆë‹¤": "í•  ì˜ˆì •ìž„",
    "í•˜ê² ë‹¤": "í•  ì˜ˆì •ìž„",
    "í•´ì•¼ í•©ë‹ˆë‹¤": "ì´ í•„ìš”í•¨",
    "í•´ì•¼ í•œë‹¤": "ì´ í•„ìš”í•¨",
}

BULLET_PATTERN = re.compile(r"^\s*([\-â€¢\*\d]+[.)\]:]|\(?\d+\)|[ê°€-íž£][.)])\s*")
MARKDOWN_PATTERN = re.compile(r"\*\*(.*?)\*\*|\*(.*?)\*|`(.*?)`")


def add_number_commas(text: str) -> str:
    """ìˆ«ìžì— ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€ (ì—°ë„ ì œì™¸)"""
    def replace_number(match):
        num = match.group(0)
        if len(num) == 4 and (num.startswith('19') or num.startswith('20')):
            return num
        if len(num) >= 4:
            return f"{int(num):,}"
        return num
    
    return re.sub(r'\b\d{4,}\b', replace_number, text)


def fix_ending(sentence: str) -> str:
    """ë¬¸ìž¥ ì¢…ê²°ì–´ë¯¸ë¥¼ ê°œê´„ì‹ìœ¼ë¡œ ë³€í™˜"""
    sentence = sentence.strip()
    if not sentence:
        return sentence
    
    if sentence.endswith('.'):
        sentence = sentence[:-1]
    
    for wrong, correct in TERM_CORRECTIONS.items():
        if sentence.endswith(wrong):
            sentence = sentence[:-len(wrong)] + correct
            break
    
    return sentence


def clean_content(text: str) -> str:
    """ì½˜í…ì¸  ì •ë¦¬"""
    text = BULLET_PATTERN.sub("", text)
    text = MARKDOWN_PATTERN.sub(r"\1\2\3", text)
    text = re.sub(r'[^\w\sê°€-íž£.,()%~\-:/Â·â—‹â–³â–·]', '', text)
    text = re.sub(r'\s{2,}', ' ', text)
    text = add_number_commas(text)
    
    return text.strip()


def postprocess_report(data: Dict[str, Any]) -> Dict[str, Any]:
    """ë³´ê³ ì„œ ì „ì²´ í›„ì²˜ë¦¬"""
    result = dict(data)
    
    if isinstance(result.get("summary"), str):
        summary = clean_content(result["summary"])
        sentences = re.split(r'(?<=[.ã€‚])\s*', summary)
        processed_sentences = [fix_ending(s) for s in sentences if s.strip()]
        result["summary"] = ' '.join(processed_sentences)
    
    processed_sections = []
    for sec in result.get("sections", []):
        sec = dict(sec)
        contents = sec.get("content", [])
        
        if isinstance(contents, str):
            contents = [contents]
        
        processed_contents = []
        for item in contents:
            if isinstance(item, str) and item.strip():
                cleaned = clean_content(item)
                fixed = fix_ending(cleaned)
                if fixed:
                    processed_contents.append(fixed)
        
        sec["content"] = processed_contents
        processed_sections.append(sec)
    
    result["sections"] = processed_sections
    return result


# ===========================================
# ðŸŒ API ì—”ë“œí¬ì¸íŠ¸
# ===========================================
@router.get("/structures", response_model=StructureResponse)
async def get_report_structures():
    """ë³´ê³ ì„œ êµ¬ì¡° ë° ì˜µì…˜ ì¡°íšŒ"""
    return StructureResponse(
        report_types=REPORT_STRUCTURES,
        length_options=list(LENGTH_RULES.keys())
    )


@router.post("/generate", response_model=ReportResponse)
async def generate_report(request: ReportGenerateRequest):
    """ì—…ë¬´ë³´ê³ ì„œ ìƒì„±"""
    
    if request.report_type not in REPORT_STRUCTURES:
        raise HTTPException(status_code=400, detail=f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ë³´ê³ ì„œ ìœ í˜•: {request.report_type}")
    
    if request.detail_type not in REPORT_STRUCTURES[request.report_type]:
        raise HTTPException(status_code=400, detail=f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ì„¸ë¶€ ìœ í˜•: {request.detail_type}")
    
    if request.length not in LENGTH_RULES:
        raise HTTPException(status_code=400, detail=f"ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¶„ëŸ‰ ì˜µì…˜: {request.length}")
    
    try:
        prompt = build_prompt(
            title=request.title,
            report_type=request.report_type,
            detail_type=request.detail_type,
            keywords=request.keywords,
            length_key=request.length
        )
        
        from openai import OpenAI
        client = OpenAI(api_key=settings.OPENAI_API_KEY)
        
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {
                    "role": "system", 
                    "content": "ë‹¹ì‹ ì€ ëŒ€í•œë¯¼êµ­ ì§€ë°©ìžì¹˜ë‹¨ì²´ ê³µë¬´ì› ì—…ë¬´ë³´ê³ ì„œ ìž‘ì„± ì „ë¬¸ê°€ìž…ë‹ˆë‹¤. ì„¹ì…˜ë³„ íŠ¹ì„±(ì„œìˆ í˜•/ë‚˜ì—´í˜•/íš¨ê³¼í˜•/ë°©ì•ˆí˜•/ë¶„ì„í˜•)ì— ë§žê²Œ ìž‘ì„±í•©ë‹ˆë‹¤. ë°˜ë“œì‹œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”."
                },
                {"role": "user", "content": prompt}
            ],
            temperature=0.4,
            response_format={"type": "json_object"},
            max_tokens=4000
        )
        
        raw_content = response.choices[0].message.content or ""
        data = json.loads(raw_content)
        
        data = postprocess_report(data)
        
        sections = [
            ReportSection(
                title=sec.get("title", ""),
                order=sec.get("order", idx + 1),
                content=sec.get("content", [])
            )
            for idx, sec in enumerate(data.get("sections", []))
        ]
        
        return ReportResponse(
            title=data.get("title", request.title),
            type=data.get("type", request.report_type),
            detail_type=data.get("detailType", request.detail_type),
            summary=data.get("summary", ""),
            sections=sections,
            metadata=data.get("metadata", {}),
            success=True
        )
        
    except json.JSONDecodeError as e:
        raise HTTPException(status_code=500, detail=f"JSON íŒŒì‹± ì‹¤íŒ¨: {str(e)}")
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"ë³´ê³ ì„œ ìƒì„± ì‹¤íŒ¨: {str(e)}")


@router.get("/status")
async def get_status():
    """ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸"""
    return {
        "status": "active",
        "service": "ì—…ë¬´ë³´ê³  ìƒì„±ê¸°",
        "version": "3.0.0",
        "supported_types": list(REPORT_STRUCTURES.keys())
    }