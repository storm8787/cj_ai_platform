# ì¶©ì£¼ì‹œ AI í”Œë«í¼ - Azure ë°°í¬ ë²„ì „

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Azure Cloud                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Azure Static Web Apps                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   React SPA (Vite + TailwindCSS)                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ ëŒ€ì‹œë³´ë“œ                                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ ë³´ë„ìë£Œ ìƒì„±ê¸°                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ ì„ ê±°ë²• ì±—ë´‡                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ ë‰´ìŠ¤ ë·°ì–´                                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                           â”‚                                       â”‚  â”‚
â”‚  â”‚                  API Proxy (/api/*)                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Azure Container Apps                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   FastAPI Backend (Python 3.11)                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ /api/press-release/* - ë³´ë„ìë£Œ ìƒì„± API               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ /api/election-law/*  - ì„ ê±°ë²• ì±—ë´‡ API                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ /api/news/*          - ë‰´ìŠ¤ ê´€ë¦¬ API                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   â€¢ /api/health          - í—¬ìŠ¤ì²´í¬                        â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                              â”‚                                    â”‚  â”‚
â”‚  â”‚                    (ì´ë¯¸ì§€: ghcr.io)                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                 â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                       â”‚                       â”‚
          â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Supabase      â”‚     â”‚   OpenAI API    â”‚     â”‚  GitHub (ghcr)  â”‚
â”‚  â€¢ Storage      â”‚     â”‚  â€¢ GPT-4o-mini  â”‚     â”‚  â€¢ Container    â”‚
â”‚  â€¢ PostgreSQL   â”‚     â”‚  â€¢ Embeddings   â”‚     â”‚    Registry     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
cj_ai_azure/
â”œâ”€â”€ frontend/                          # Azure Static Web Apps
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/                     # í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PressRelease.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ElectionLaw.jsx
â”‚   â”‚   â”‚   â””â”€â”€ NewsViewer.jsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ Layout.jsx
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â””â”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ App.jsx
â”‚   â”‚   â”œâ”€â”€ main.jsx
â”‚   â”‚   â””â”€â”€ index.css
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â”œâ”€â”€ staticwebapp.config.json       # â­ Azure SWA ì„¤ì •
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ backend/                           # Azure Container Apps
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ press_release.py
â”‚   â”‚   â”œâ”€â”€ election_law.py
â”‚   â”‚   â”œâ”€â”€ news.py
â”‚   â”‚   â””â”€â”€ health.py
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ vectorstore.py
â”‚   â”‚   â”œâ”€â”€ openai_service.py
â”‚   â”‚   â””â”€â”€ supabase_service.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ prompt_filter.py
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ config.py
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ Dockerfile                     # â­ Container Appsìš©
â”‚   â””â”€â”€ .env.example
â”‚
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ azure-swa-deploy.yml           # â­ í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬
â”‚   â””â”€â”€ azure-aca-deploy.yml           # â­ ë°±ì—”ë“œ ë°°í¬
â”‚
â””â”€â”€ README.md
```

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

### ì‚¬ì „ ì¤€ë¹„ì‚¬í•­

1. **Azure ê³„ì •** ë° êµ¬ë…
2. **GitHub ì €ì¥ì†Œ** (ì½”ë“œ ì—…ë¡œë“œ ì™„ë£Œ)
3. **GitHub Personal Access Token** (ghcr.ioìš©, `read:packages`, `write:packages` ê¶Œí•œ)

---

## ğŸ–¥ï¸ Azure Portal ë°°í¬ (GUI ë°©ì‹)

### Step 1: ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„±

1. [Azure Portal](https://portal.azure.com) ì ‘ì† â†’ ë¡œê·¸ì¸
2. ìƒë‹¨ ê²€ìƒ‰ì°½ì— **"ë¦¬ì†ŒìŠ¤ ê·¸ë£¹"** ê²€ìƒ‰ â†’ í´ë¦­
3. **â• ë§Œë“¤ê¸°** í´ë¦­
4. ì„¤ì • ì…ë ¥:
   - **êµ¬ë…**: ì‚¬ìš©í•  êµ¬ë… ì„ íƒ
   - **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: `rg-cj-ai-platform`
   - **ì§€ì—­**: `Korea Central`
5. **ê²€í†  + ë§Œë“¤ê¸°** â†’ **ë§Œë“¤ê¸°**

---

### Step 2: Container Apps í™˜ê²½ ìƒì„±

1. ìƒë‹¨ ê²€ìƒ‰ì°½ì— **"Container Apps í™˜ê²½"** ê²€ìƒ‰ â†’ í´ë¦­
2. **â• ë§Œë“¤ê¸°** í´ë¦­
3. **ê¸°ë³¸ ì‚¬í•­** íƒ­:
   - **êµ¬ë…**: ì„ íƒ
   - **ë¦¬ì†ŒìŠ¤ ê·¸ë£¹**: `rg-cj-ai-platform`
   - **í™˜ê²½ ì´ë¦„**: `cj-ai-env`
   - **ì§€ì—­**: `Korea Central`
   - **ì˜ì—­ ì¤‘ë³µ**: ì‚¬ìš© ì•ˆ í•¨
4. **ëª¨ë‹ˆí„°ë§** íƒ­:
   - **Log Analytics ì‘ì—… ì˜ì—­**: ìƒˆë¡œ ë§Œë“¤ê¸° ë˜ëŠ” ê¸°ì¡´ ì„ íƒ
5. **ê²€í†  + ë§Œë“¤ê¸°** â†’ **ë§Œë“¤ê¸°**

---

### Step 3: Container App ìƒì„± (ë°±ì—”ë“œ)

#### 3-1. ë¨¼ì € GitHubì— Docker ì´ë¯¸ì§€ í‘¸ì‹œ

ë¡œì»¬ì—ì„œ í•œ ë²ˆë§Œ ì‹¤í–‰ (ë˜ëŠ” GitHub Actionsê°€ ìë™ ì²˜ë¦¬):
```bash
# ë¡œì»¬ í„°ë¯¸ë„ì—ì„œ
cd backend
echo YOUR_GITHUB_TOKEN | docker login ghcr.io -u YOUR_USERNAME --password-stdin
docker build -t ghcr.io/YOUR_USERNAME/cj-ai-backend:latest .
docker push ghcr.io/YOUR_USERNAME/cj-ai-backend:latest
```

#### 3-2. GitHub Packageë¥¼ Publicìœ¼ë¡œ ì„¤ì •

1. GitHub ì €ì¥ì†Œ â†’ **Packages** íƒ­
2. `cj-ai-backend` íŒ¨í‚¤ì§€ í´ë¦­
3. ìš°ì¸¡ **Package settings**
4. í•˜ë‹¨ **Danger Zone** â†’ **Change visibility** â†’ **Public**

#### 3-3. Azure Portalì—ì„œ Container App ìƒì„±

1. ìƒë‹¨ ê²€ìƒ‰ì°½ì— **"Container Apps"** ê²€ìƒ‰ â†’ í´ë¦­
2. **â• ë§Œë“¤ê¸°** í´ë¦­

3. **ê¸°ë³¸ ì‚¬í•­** íƒ­:
   | í•­ëª© | ê°’ |
   |------|-----|
   | êµ¬ë… | ì„ íƒ |
   | ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ | `rg-cj-ai-platform` |
   | ì»¨í…Œì´ë„ˆ ì•± ì´ë¦„ | `cj-ai-backend` |
   | ì§€ì—­ | `Korea Central` |
   | Container Apps í™˜ê²½ | `cj-ai-env` ì„ íƒ |

4. **ì»¨í…Œì´ë„ˆ** íƒ­:
   | í•­ëª© | ê°’ |
   |------|-----|
   | ë¹ ë¥¸ ì‹œì‘ ì´ë¯¸ì§€ ì‚¬ìš© | âŒ ì²´í¬ í•´ì œ |
   | ì´ë¯¸ì§€ ì›ë³¸ | `Docker Hub ë˜ëŠ” ê¸°íƒ€ ë ˆì§€ìŠ¤íŠ¸ë¦¬` |
   | ì´ë¯¸ì§€ í˜•ì‹ | `Public` |
   | ë ˆì§€ìŠ¤íŠ¸ë¦¬ ë¡œê·¸ì¸ ì„œë²„ | `ghcr.io` |
   | ì´ë¯¸ì§€ ë° íƒœê·¸ | `YOUR_USERNAME/cj-ai-backend:latest` |
   | CPU ë° ë©”ëª¨ë¦¬ | `0.5 vCPU, 1 GiB` (ë˜ëŠ” í•„ìš”ì— ë”°ë¼) |

5. **ì»¨í…Œì´ë„ˆ** íƒ­ â†’ **í™˜ê²½ ë³€ìˆ˜** ì„¹ì…˜ì—ì„œ **â• ì¶”ê°€**:
   | ì´ë¦„ | ì†ŒìŠ¤ | ê°’ |
   |------|------|-----|
   | `OPENAI_API_KEY` | ìˆ˜ë™ í•­ëª© | `sk-your-key` |
   | `SUPABASE_URL` | ìˆ˜ë™ í•­ëª© | `https://xxx.supabase.co` |
   | `SUPABASE_KEY` | ìˆ˜ë™ í•­ëª© | `your-key` |
   | `CORS_ORIGINS` | ìˆ˜ë™ í•­ëª© | `http://localhost:5173` (ë‚˜ì¤‘ì— SWA URL ì¶”ê°€) |

6. **ìˆ˜ì‹ ** íƒ­:
   | í•­ëª© | ê°’ |
   |------|-----|
   | ìˆ˜ì‹  | âœ… ì‚¬ìš© |
   | ìˆ˜ì‹  íŠ¸ë˜í”½ | `ì–´ë””ì„œë‚˜ íŠ¸ë˜í”½ í—ˆìš©` |
   | ìˆ˜ì‹  í˜•ì‹ | `HTTP` |
   | ëŒ€ìƒ í¬íŠ¸ | `8000` |

7. **ê²€í†  + ë§Œë“¤ê¸°** â†’ **ë§Œë“¤ê¸°**

8. ë°°í¬ ì™„ë£Œ í›„ **ë¦¬ì†ŒìŠ¤ë¡œ ì´ë™** â†’ **ì• í”Œë¦¬ì¼€ì´ì…˜ URL** ë³µì‚¬
   - ì˜ˆ: `https://cj-ai-backend.koreacentral.azurecontainerapps.io`

---

### Step 4: Static Web App ìƒì„± (í”„ë¡ íŠ¸ì—”ë“œ)

1. ìƒë‹¨ ê²€ìƒ‰ì°½ì— **"Static Web Apps"** ê²€ìƒ‰ â†’ í´ë¦­
2. **â• ë§Œë“¤ê¸°** í´ë¦­

3. **ê¸°ë³¸ ì‚¬í•­** íƒ­:
   | í•­ëª© | ê°’ |
   |------|-----|
   | êµ¬ë… | ì„ íƒ |
   | ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ | `rg-cj-ai-platform` |
   | ì´ë¦„ | `cj-ai-frontend` |
   | í˜¸ìŠ¤íŒ… ê³„íš | `ë¬´ë£Œ` |
   | ì§€ì—­ | `East Asia` (í•œêµ­ ê°€ê¹Œìš´ ê³³) |
   | ì›ë³¸ | `GitHub` |

4. **GitHub ê³„ì • ì—°ê²°** ë²„íŠ¼ í´ë¦­ â†’ ë¡œê·¸ì¸ â†’ ê¶Œí•œ ë¶€ì—¬

5. **GitHub ì„¤ì •**:
   | í•­ëª© | ê°’ |
   |------|-----|
   | ì¡°ì§ | ë³¸ì¸ ê³„ì • |
   | ë¦¬í¬ì§€í† ë¦¬ | í”„ë¡œì íŠ¸ ì €ì¥ì†Œ ì„ íƒ |
   | ë¶„ê¸° | `main` |

6. **ë¹Œë“œ ì„¸ë¶€ ì •ë³´**:
   | í•­ëª© | ê°’ |
   |------|-----|
   | ë¹Œë“œ ì‚¬ì „ ì„¤ì • | `Custom` |
   | ì•± ìœ„ì¹˜ | `/frontend` |
   | API ìœ„ì¹˜ | (ë¹„ì›Œë‘ê¸°) |
   | ì¶œë ¥ ìœ„ì¹˜ | `dist` |

7. **ê²€í†  + ë§Œë“¤ê¸°** â†’ **ë§Œë“¤ê¸°**

8. ë°°í¬ ì™„ë£Œ í›„:
   - **ë¦¬ì†ŒìŠ¤ë¡œ ì´ë™** â†’ **URL** ë³µì‚¬
   - ì˜ˆ: `https://cj-ai-frontend.azurestaticapps.net`

---

### Step 5: í”„ë¡ íŠ¸ì—”ë“œ â†” ë°±ì—”ë“œ ì—°ê²°

#### 5-1. í”„ë¡ íŠ¸ì—”ë“œ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

1. Static Web App ë¦¬ì†ŒìŠ¤ â†’ ì¢Œì¸¡ ë©”ë‰´ **êµ¬ì„±**
2. **â• ì¶”ê°€** í´ë¦­:
   | ì´ë¦„ | ê°’ |
   |------|-----|
   | `VITE_API_URL` | `https://cj-ai-backend.koreacentral.azurecontainerapps.io` |
3. **ì €ì¥**

#### 5-2. ë°±ì—”ë“œ CORS ì—…ë°ì´íŠ¸

1. Container App ë¦¬ì†ŒìŠ¤ â†’ ì¢Œì¸¡ ë©”ë‰´ **ì»¨í…Œì´ë„ˆ**
2. **í¸ì§‘ ë° ë°°í¬** í´ë¦­
3. ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì˜† **í¸ì§‘** í´ë¦­
4. í™˜ê²½ ë³€ìˆ˜ì—ì„œ `CORS_ORIGINS` ìˆ˜ì •:
   ```
   https://cj-ai-frontend.azurestaticapps.net,http://localhost:5173
   ```
5. **ì €ì¥** â†’ **ë§Œë“¤ê¸°**

#### 5-3. staticwebapp.config.json ìˆ˜ì •

GitHub ì €ì¥ì†Œì˜ `frontend/staticwebapp.config.json` íŒŒì¼ ìˆ˜ì •:
```json
{
  "routes": [
    {
      "route": "/api/*",
      "allowedRoles": ["anonymous"],
      "rewrite": "https://cj-ai-backend.koreacentral.azurecontainerapps.io/api/*"
    }
  ]
}
```

ì»¤ë°‹ & í‘¸ì‹œí•˜ë©´ ìë™ ì¬ë°°í¬ë¨.

---

### Step 6: ë°°í¬ í™•ì¸

1. **ë°±ì—”ë“œ í—¬ìŠ¤ì²´í¬**:
   - ë¸Œë¼ìš°ì €ì—ì„œ `https://cj-ai-backend.xxx.azurecontainerapps.io/api/health` ì ‘ì†
   - `{"status": "healthy"}` ì‘ë‹µ í™•ì¸

2. **í”„ë¡ íŠ¸ì—”ë“œ ì ‘ì†**:
   - `https://cj-ai-frontend.azurestaticapps.net` ì ‘ì†
   - ëŒ€ì‹œë³´ë“œì—ì„œ "ì„œë²„ ì •ìƒ" í‘œì‹œ í™•ì¸

---

## âŒ¨ï¸ CLI ë°°í¬ (ëª…ë ¹ì–´ ë°©ì‹)

<details>
<summary>CLI ëª…ë ¹ì–´ë¡œ ë°°í¬í•˜ê¸° (í´ë¦­í•´ì„œ í¼ì¹˜ê¸°)</summary>

### Step 1: Azure ë¦¬ì†ŒìŠ¤ ìƒì„±

```bash
# Azure ë¡œê·¸ì¸
az login

# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„±
az group create --name rg-cj-ai-platform --location koreacentral

# Container Apps í™˜ê²½ ìƒì„±
az containerapp env create --name cj-ai-env \
    --resource-group rg-cj-ai-platform \
    --location koreacentral
```

### Step 2: ë°±ì—”ë“œ ë°°í¬

```bash
# GitHub Container Registry ë¡œê·¸ì¸
echo $GITHUB_TOKEN | docker login ghcr.io -u USERNAME --password-stdin

# Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° í‘¸ì‹œ
cd backend
docker build -t ghcr.io/YOUR_USERNAME/cj-ai-backend:latest .
docker push ghcr.io/YOUR_USERNAME/cj-ai-backend:latest

# Container App ìƒì„±
az containerapp create --name cj-ai-backend \
    --resource-group rg-cj-ai-platform \
    --environment cj-ai-env \
    --image ghcr.io/YOUR_USERNAME/cj-ai-backend:latest \
    --target-port 8000 \
    --ingress external \
    --env-vars \
        OPENAI_API_KEY=sk-xxx \
        SUPABASE_URL=https://xxx.supabase.co \
        SUPABASE_KEY=xxx \
        CORS_ORIGINS=http://localhost:5173
```

### Step 3: GitHub Actions ìë™ ë°°í¬ ì„¤ì •

GitHub ì €ì¥ì†Œ Settings â†’ Secretsì— ì¶”ê°€:

| Secret ì´ë¦„ | ê°’ |
|------------|---|
| `AZURE_CREDENTIALS` | Azure Service Principal JSON |

```bash
# Service Principal ìƒì„±
az ad sp create-for-rbac --name "cj-ai-github-actions" \
    --role contributor \
    --scopes /subscriptions/{subscription-id}/resourceGroups/rg-cj-ai-platform \
    --sdk-auth
```

</details>

---

## ğŸ”§ ë¡œì»¬ ê°œë°œ

### í”„ë¡ íŠ¸ì—”ë“œ
```bash
cd frontend
npm install
npm run dev    # http://localhost:5173
```

### ë°±ì—”ë“œ
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn main:app --reload --port 8000
```

## ğŸ“ GitHub Actions (CI/CD ìë™í™”)

GitHubì— í‘¸ì‹œí•˜ë©´ ìë™ ë°°í¬ë˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### í•„ìš”í•œ GitHub Secrets ì„¤ì •

GitHub ì €ì¥ì†Œ â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions** â†’ **New repository secret**

| Secret ì´ë¦„ | ì„¤ëª… | ì–»ëŠ” ë°©ë²• |
|------------|------|----------|
| `AZURE_CREDENTIALS` | Azure ì¸ì¦ ì •ë³´ | ì•„ë˜ ì°¸ì¡° |

### Azure Credentials ìƒì„± ë°©ë²•

<details>
<summary>Azure Portalì—ì„œ ìƒì„±í•˜ê¸° (í´ë¦­)</summary>

1. Azure Portal â†’ **Microsoft Entra ID** (êµ¬ Azure AD)
2. ì¢Œì¸¡ **ì•± ë“±ë¡** â†’ **â• ìƒˆ ë“±ë¡**
3. ì´ë¦„: `cj-ai-github-actions` â†’ **ë“±ë¡**
4. ìƒì„±ëœ ì•±ì—ì„œ:
   - **ê°œìš”** â†’ `ì• í”Œë¦¬ì¼€ì´ì…˜(í´ë¼ì´ì–¸íŠ¸) ID` ë³µì‚¬
   - **ê°œìš”** â†’ `ë””ë ‰í„°ë¦¬(í…Œë„ŒíŠ¸) ID` ë³µì‚¬
5. **ì¸ì¦ì„œ ë° ë¹„ë°€** â†’ **â• ìƒˆ í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€**
   - ì„¤ëª…: `github-actions`
   - ë§Œë£Œ: 24ê°œì›”
   - **ì¶”ê°€** â†’ ê°’ ë³µì‚¬ (í•œ ë²ˆë§Œ í‘œì‹œë¨!)
6. **êµ¬ë…** â†’ ì‚¬ìš© ì¤‘ì¸ êµ¬ë… â†’ **ì•¡ì„¸ìŠ¤ ì œì–´(IAM)**
   - **â• ì¶”ê°€** â†’ **ì—­í•  í• ë‹¹ ì¶”ê°€**
   - ì—­í• : `Contributor`
   - ë©¤ë²„: `cj-ai-github-actions` ì•± ì„ íƒ
   - **ê²€í†  + í• ë‹¹**

7. ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œ `AZURE_CREDENTIALS` ìƒì„±:
```json
{
  "clientId": "ì• í”Œë¦¬ì¼€ì´ì…˜-ID",
  "clientSecret": "í´ë¼ì´ì–¸íŠ¸-ë¹„ë°€-ê°’",
  "subscriptionId": "êµ¬ë…-ID",
  "tenantId": "í…Œë„ŒíŠ¸-ID"
}
```
</details>

<details>
<summary>Azure CLIë¡œ ìƒì„±í•˜ê¸° (í´ë¦­)</summary>

```bash
az ad sp create-for-rbac --name "cj-ai-github-actions" \
    --role contributor \
    --scopes /subscriptions/{êµ¬ë…ID}/resourceGroups/rg-cj-ai-platform \
    --sdk-auth
```
ì¶œë ¥ëœ JSON ì „ì²´ë¥¼ `AZURE_CREDENTIALS`ì— ì €ì¥

</details>

## ğŸ” ë³´ì•ˆ ì„¤ì •

### CORS ì„¤ì • (backend/main.py)
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "https://your-swa-name.azurestaticapps.net",  # í”„ë¡œë•ì…˜
        "http://localhost:5173"  # ë¡œì»¬ ê°œë°œ
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### API í‚¤ ë³´í˜¸
- Azure Key Vault ë˜ëŠ” Container Apps Secrets ì‚¬ìš©
- GitHub Secretsë¡œ CI/CD íŒŒì´í”„ë¼ì¸ì—ì„œ ì£¼ì…

## ğŸ’° ì˜ˆìƒ ë¹„ìš© (ì›”ê°„)

| ì„œë¹„ìŠ¤ | í‹°ì–´ | ì˜ˆìƒ ë¹„ìš© |
|--------|------|----------|
| Static Web Apps | Free | â‚©0 |
| Container Apps | Consumption | ~â‚©10,000~30,000 |
| GitHub Container Registry | Free (Public) | â‚©0 |
| **ì´ ì˜ˆìƒ** | | **~â‚©10,000~30,000/ì›”** |

*íŠ¸ë˜í”½ì´ ì ì€ ê²½ìš° Container Appsë„ ë¬´ë£Œ í‹°ì–´ ë‚´ì—ì„œ ìš´ì˜ ê°€ëŠ¥
*ghcr.io Private ì €ì¥ì†Œë„ GitHub Free í”Œëœì—ì„œ 500MB ë¬´ë£Œ

## ğŸ†˜ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### CORS ì˜¤ë¥˜
- Container Appsì˜ í™˜ê²½ë³€ìˆ˜ `CORS_ORIGINS`ì— SWA ë„ë©”ì¸ ì¶”ê°€
- `https://` í¬í•¨ ì „ì²´ URL ì…ë ¥

### API ì—°ê²° ì‹¤íŒ¨
- staticwebapp.config.jsonì˜ rewrite URL í™•ì¸
- Container Appsì˜ ingress ì„¤ì • í™•ì¸ (external)

### ë¹Œë“œ ì‹¤íŒ¨
- Node.js ë²„ì „ í™•ì¸ (18.x ê¶Œì¥)
- Python ë²„ì „ í™•ì¸ (3.11 ê¶Œì¥)
